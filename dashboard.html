<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>لوحة التحكم | clinic-system</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
*{box-sizing:border-box}
body{margin:0;font-family:Tahoma,Arial;background:#f3f4f6}
.hidden{display:none}
.app{display:grid;grid-template-columns:260px 1fr;min-height:100vh}
.sidebar{background:#fff;border-left:1px solid #e5e7eb;padding:20px}
.brand{font-size:20px;font-weight:bold;margin-bottom:25px}
.nav button{width:100%;border:none;background:transparent;padding:12px;border-radius:10px;text-align:right;cursor:pointer}
.nav button.active,.nav button:hover{background:#eef2ff;color:#1d4ed8}
.logout{margin-top:20px;background:#ef4444;color:#fff;border:none;padding:12px;border-radius:10px;width:100%}
.content{padding:25px}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.primary{background:#2563eb;color:#fff;border:none;padding:10px 16px;border-radius:8px;cursor:pointer}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:15px}
.card{background:#fff;padding:15px;border-radius:14px;box-shadow:0 5px 15px rgba(0,0,0,.08)}
input,select,textarea{padding:8px;border-radius:6px;border:1px solid #d1d5db;width:100%}
.panel{background:#fff;padding:15px;border-radius:14px;margin-bottom:15px}
</style>
</head>

<body>

<script>
if(!localStorage.getItem("currentUser")) location.href="index.html";
</script>

<div class="app">

<aside class="sidebar">
  <div class="brand">clinic-system</div>
  <div class="nav">
    <button class="active" onclick="showPage('patients',this)">المرضى</button>
    <button onclick="showPage('sessions',this)">الجلسات</button>
  </div>
  <button class="logout" onclick="logout()">تسجيل خروج</button>
</aside>

<main class="content">

<div class="header">
  <h2 id="pageTitle">المرضى</h2>
</div>

<!-- PATIENTS -->
<section id="patientsPage">
  <button class="primary" onclick="addPatient()">+ إضافة مريض</button>
  <div id="patientsGrid" class="grid" style="margin-top:15px"></div>
</section>

<!-- SESSIONS -->
<section id="sessionsPage" class="hidden">
  <div class="panel">
    <h3>إضافة جلسة</h3>
    <select id="sessionPatient"></select>
    <input type="date" id="sessionDate">
    <input type="number" id="sessionAmount" placeholder="المبلغ المدفوع">
    <textarea id="sessionNote" placeholder="ملاحظات"></textarea>
    <button class="primary" onclick="saveSession()">حفظ الجلسة</button>
  </div>

  <div class="panel">
    <h3>كل الجلسات</h3>
    <div id="sessionsList"></div>
  </div>
</section>

</main>
</div>

<script>
let patients = JSON.parse(localStorage.getItem("patients")||"[]");

function showPage(page,btn){
  document.querySelectorAll(".nav button").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  pageTitle.innerText = btn.innerText;
  patientsPage.classList.toggle("hidden", page!=="patients");
  sessionsPage.classList.toggle("hidden", page!=="sessions");
  if(page==="patients") renderPatients();
  if(page==="sessions"){ fillPatientsSelect(); renderSessions(); }
}

function addPatient(){
  const name=prompt("اسم المريض");
  const total=Number(prompt("المبلغ الكلي"));
  if(!name||!total) return;
  patients.push({name,total,sessions:[]});
  localStorage.setItem("patients",JSON.stringify(patients));
  renderPatients();
}

function renderPatients(){
  patientsGrid.innerHTML="";
  patients.forEach(p=>{
    const paid=p.sessions.reduce((a,s)=>a+s.amount,0);
    patientsGrid.innerHTML+=`
      <div class="card">
        <b>${p.name}</b><br>
        الإجمالي: ${p.total}<br>
        المدفوع: ${paid}<br>
        المتبقي: ${p.total-paid}
      </div>`;
  });
}

function fillPatientsSelect(){
  sessionPatient.innerHTML="";
  patients.forEach((p,i)=>{
    sessionPatient.innerHTML+=`<option value="${i}">${p.name}</option>`;
  });
}

function saveSession(){
  const i=sessionPatient.value;
  if(!sessionDate.value||!sessionAmount.value) return;
  patients[i].sessions.push({
    date:sessionDate.value,
    amount:Number(sessionAmount.value),
    note:sessionNote.value
  });
  localStorage.setItem("patients",JSON.stringify(patients));
  sessionAmount.value="";sessionNote.value="";
  renderSessions();
}

function renderSessions(){
  sessionsList.innerHTML="";
  patients.forEach(p=>{
    p.sessions.forEach(s=>{
      sessionsList.innerHTML+=`
        <div class="card">
          <b>${p.name}</b><br>
          ${s.date} – ${s.amount}
        </div>`;
    });
  });
}

function logout(){
  localStorage.removeItem("currentUser");
  location.href="index.html";
}

renderPatients();
</script>

</body>
</html>
