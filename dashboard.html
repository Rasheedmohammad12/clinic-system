<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | clinic-system</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
*{box-sizing:border-box}
body{margin:0;font-family:Tahoma,Arial;background:#f3f4f6}
.hidden{display:none}
.app{display:grid;grid-template-columns:260px 1fr;min-height:100vh}

/* SIDEBAR */
.sidebar{background:#fff;border-left:1px solid #e5e7eb;padding:20px}
.brand{font-size:20px;font-weight:bold;margin-bottom:25px}
.nav button{width:100%;border:none;background:transparent;padding:12px;border-radius:10px;text-align:right;cursor:pointer}
.nav button.active,.nav button:hover{background:#eef2ff;color:#1d4ed8}
.logout{margin-top:20px;background:#ef4444;color:#fff;border:none;padding:12px;border-radius:10px;width:100%}

/* CONTENT */
.content{padding:25px}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.primary{background:#2563eb;color:#fff;border:none;padding:10px 16px;border-radius:8px;cursor:pointer}

.panel{background:#fff;padding:15px;border-radius:14px;margin-bottom:15px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:15px}
.card{background:#fff;padding:15px;border-radius:14px;box-shadow:0 5px 15px rgba(0,0,0,.08)}
input,select,textarea{padding:8px;border-radius:6px;border:1px solid #d1d5db;width:100%}

/* MODAL */
.backdrop{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:1000}
.modal{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
background:#fff;width:480px;max-width:95%;padding:20px;border-radius:14px;z-index:1001}
</style>
</head>

<body>

<script>
if(!localStorage.getItem("currentUser")) location.href="index.html";

/* ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª */
if(!localStorage.getItem("paymentsPassword")){
  localStorage.setItem("paymentsPassword","1234"); // Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
}
</script>

<div class="app">

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="brand">clinic-system</div>
  <div class="nav">
    <button class="active" onclick="showPage('patients',this)">Ø§Ù„Ù…Ø±Ø¶Ù‰</button>
    <button onclick="showPage('sessions',this)">Ø§Ù„Ø¬Ù„Ø³Ø§Øª</button>
    <button onclick="openPayments()">Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</button>
    <button onclick="showPage('settings',this)">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
  </div>
  <button class="logout" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</aside>

<!-- CONTENT -->
<main class="content">

<div class="header">
  <h2 id="pageTitle">Ø§Ù„Ù…Ø±Ø¶Ù‰</h2>
</div>

<!-- PATIENTS -->
<section id="patientsPage">
  <button class="primary" onclick="addPatient()">+ Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙŠØ¶</button>
  <div id="patientsGrid" class="grid" style="margin-top:15px"></div>
</section>

<!-- SESSIONS -->
<section id="sessionsPage" class="hidden">
  <div class="panel">
    <h3>Ø¥Ø¶Ø§ÙØ© Ø¬Ù„Ø³Ø©</h3>
    <select id="sessionPatient"></select>
    <input type="date" id="sessionDate">
    <input type="number" id="sessionAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹">
    <textarea id="sessionNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª"></textarea>
    <button class="primary" onclick="saveSession()">Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø©</button>
  </div>

  <div class="panel">
    <h3>ÙƒÙ„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª</h3>
    <div id="sessionsList"></div>
  </div>
</section>

<!-- PAYMENTS -->
<section id="paymentsPage" class="hidden">
  <div class="panel">
    <h3>Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª (Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø§Øª)</h3>
    <div id="paymentsList"></div>
    <hr>
    <h3>ğŸ’° Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: <span id="paymentsTotal">0</span></h3>
  </div>
</section>

<!-- SETTINGS -->
<section id="settingsPage" class="hidden">
  <div class="panel">
    <h3>ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</h3>
    <input id="newPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
    <button class="primary" onclick="changePassword()">Ø­ÙØ¸</button>
  </div>
</section>

</main>
</div>

<script>
let patients = JSON.parse(localStorage.getItem("patients")||"[]");

function showPage(page,btn){
  document.querySelectorAll(".nav button").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  pageTitle.innerText = btn.innerText;

  patientsPage.classList.toggle("hidden", page!=="patients");
  sessionsPage.classList.toggle("hidden", page!=="sessions");
  paymentsPage.classList.add("hidden");
  settingsPage.classList.toggle("hidden", page!=="settings");

  if(page==="patients") renderPatients();
  if(page==="sessions"){ fillPatientsSelect(); renderSessions(); }
}

function addPatient(){
  const name=prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶");
  const total=Number(prompt("Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙƒÙ„ÙŠ"));
  if(!name||!total) return;
  patients.push({name,total,sessions:[]});
  localStorage.setItem("patients",JSON.stringify(patients));
  renderPatients();
}

function renderPatients(){
  patientsGrid.innerHTML="";
  patients.forEach(p=>{
    const paid=p.sessions.reduce((a,s)=>a+s.amount,0);
    patientsGrid.innerHTML+=`
      <div class="card">
        <b>${p.name}</b><br>
        Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${p.total}<br>
        Ø§Ù„Ù…Ø¯ÙÙˆØ¹: ${paid}<br>
        Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${p.total-paid}
      </div>`;
  });
}

function fillPatientsSelect(){
  sessionPatient.innerHTML="";
  patients.forEach((p,i)=>{
    sessionPatient.innerHTML+=`<option value="${i}">${p.name}</option>`;
  });
}

function saveSession(){
  const i=sessionPatient.value;
  if(!sessionDate.value||!sessionAmount.value) return;
  patients[i].sessions.push({
    date:sessionDate.value,
    amount:Number(sessionAmount.value),
    note:sessionNote.value
  });
  localStorage.setItem("patients",JSON.stringify(patients));
  sessionAmount.value="";sessionNote.value="";
  renderSessions();
}

function renderSessions(){
  sessionsList.innerHTML="";
  patients.forEach(p=>{
    p.sessions.forEach(s=>{
      sessionsList.innerHTML+=`
        <div class="card">
          <b>${p.name}</b><br>
          ${s.date} â€“ ${s.amount}
        </div>`;
    });
  });
}

function openPayments(){
  const pass=prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª:");
  if(pass!==localStorage.getItem("paymentsPassword")){
    alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
    return;
  }
  pageTitle.innerText="Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª";
  patientsPage.classList.add("hidden");
  sessionsPage.classList.add("hidden");
  settingsPage.classList.add("hidden");
  paymentsPage.classList.remove("hidden");
  renderPayments();
}

function renderPayments(){
  paymentsList.innerHTML="";
  let total=0;
  patients.forEach(p=>{
    p.sessions.forEach(s=>{
      total+=s.amount;
      paymentsList.innerHTML+=`
        <div class="card">
          <b>${p.name}</b><br>
          ${s.date} â€“ ${s.amount}
        </div>`;
    });
  });
  paymentsTotal.innerText=total;
}

function changePassword(){
  if(!newPass.value) return;
  localStorage.setItem("paymentsPassword",newPass.value);
  alert("ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±");
  newPass.value="";
}

function logout(){
  localStorage.removeItem("currentUser");
  location.href="index.html";
}

renderPatients();
</script>

</body>
</html>
