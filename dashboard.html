<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | clinic-system</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Tahoma,Arial;background:#f3f4f6}
.hidden{display:none}

/* Layout */
.app{display:grid;grid-template-columns:260px 1fr;min-height:100vh}
.sidebar{background:#fff;border-left:1px solid #e5e7eb;padding:20px}
.brand{font-size:20px;font-weight:bold;margin-bottom:25px}
.nav button{width:100%;border:none;background:transparent;padding:12px;border-radius:10px;text-align:right;cursor:pointer}
.nav button.active,.nav button:hover{background:#eef2ff;color:#1d4ed8}
.logout{margin-top:20px;background:#ef4444;color:#fff;border:none;padding:12px;border-radius:10px;width:100%}

.content{padding:25px}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.stats{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:15px}
.stat{background:#fff;padding:18px;border-radius:14px;box-shadow:0 5px 15px rgba(0,0,0,.08)}
.stat .num{font-size:26px;font-weight:bold;margin-top:6px}

.primary{background:#2563eb;color:#fff;border:none;padding:10px 16px;border-radius:8px;cursor:pointer}

.grid{margin-top:20px;display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:15px}
.card{background:#fff;padding:15px;border-radius:14px;box-shadow:0 5px 15px rgba(0,0,0,.08);cursor:pointer}

/* Modal */
.backdrop{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:1000}
.modal{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
background:#fff;width:480px;max-width:95%;padding:20px;border-radius:14px;z-index:1001}
.modal label{display:block;margin-top:10px}
.modal input,.modal textarea{width:100%;padding:8px;margin-top:5px;border-radius:6px;border:1px solid #d1d5db}
.modal textarea{resize:none;height:70px}

.toast{display:none;position:fixed;top:20px;left:50%;transform:translateX(-50%);
background:#dcfce7;color:#166534;padding:12px 18px;border-radius:10px;z-index:2000}
</style>
</head>

<body>

<script>
if(!localStorage.getItem("currentUser")) location.href="index.html";
</script>

<div class="app">

<aside class="sidebar">
  <div class="brand">clinic-system</div>
  <div class="nav">
    <button class="active" onclick="goPatients(this)">Ø§Ù„Ù…Ø±Ø¶Ù‰</button>
  </div>
  <button class="logout" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</aside>

<main class="content">

<div class="header">
  <h2>Ø§Ù„Ù…Ø±Ø¶Ù‰</h2>
  <button class="primary" onclick="openAddPatient()">+ Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙŠØ¶</button>
</div>

<div class="stats">
  <div class="stat"><small>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø¶Ù‰</small><div class="num" id="sPatients">0</div></div>
</div>

<div id="patientsGrid" class="grid"></div>

</main>
</div>

<!-- Toast -->
<div id="toast" class="toast"></div>

<!-- Modal Add Patient -->
<div id="backdrop" class="backdrop"></div>
<div id="patientModal" class="modal">
  <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙŠØ¶ Ø¬Ø¯ÙŠØ¯</h3>

  <label>Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù *</label>
  <input id="pFile">

  <label>Ø§Ù„Ø§Ø³Ù… *</label>
  <input id="pName">

  <label>Ø§Ù„Ù‡Ø§ØªÙ *</label>
  <input id="pPhone">

  <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</label>
  <input id="pDate" type="date">

  <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙƒÙ„ÙŠ *</label>
  <input id="pTotal" type="number">

  <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
  <textarea id="pNotes"></textarea>

  <div style="margin-top:15px;display:flex;gap:10px">
    <button onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
    <button class="primary" onclick="savePatient()">Ø­ÙØ¸</button>
  </div>
</div>

<!-- Modal Sessions -->
<div id="sessionModal" class="modal">
  <h3 id="sessionTitle"></h3>

  <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¬Ù„Ø³Ø©</label>
  <input id="sDate" type="date">

  <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹</label>
  <input id="sPaid" type="number">

  <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
  <textarea id="sNote"></textarea>

  <div style="margin-top:15px;display:flex;gap:10px">
    <button onclick="closeSession()">Ø¥ØºÙ„Ø§Ù‚</button>
    <button class="primary" onclick="addSession()">Ø¥Ø¶Ø§ÙØ© Ø¬Ù„Ø³Ø©</button>
  </div>

  <div id="sessionsList" style="margin-top:15px"></div>
</div>

<script>
const toast=document.getElementById("toast");
const patientsGrid=document.getElementById("patientsGrid");
let patients=JSON.parse(localStorage.getItem("patients")||"[]");
let currentPatient=null;

function showToast(msg){
  toast.innerText=msg;
  toast.style.display="block";
  setTimeout(()=>toast.style.display="none",2500);
}

function openAddPatient(){
  backdrop.style.display="block";
  patientModal.style.display="block";
  pDate.value=new Date().toISOString().split("T")[0];
}
function closeModal(){
  backdrop.style.display="none";
  patientModal.style.display="none";
}

function savePatient(){
  if(!pFile.value||!pName.value||!pPhone.value||!pTotal.value){
    showToast("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©");
    return;
  }

  patients.push({
    fileNo:pFile.value,
    name:pName.value,
    phone:pPhone.value,
    date:pDate.value,
    notes:pNotes.value,
    total:Number(pTotal.value),
    sessions:[]
  });

  localStorage.setItem("patients",JSON.stringify(patients));
  closeModal();
  renderPatients();
  showToast("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±ÙŠØ¶");
}

function renderPatients(){
  patientsGrid.innerHTML="";
  sPatients.innerText=patients.length;

  patients.forEach((p,i)=>{
    const paid=p.sessions.reduce((a,s)=>a+s.paid,0);
    const remain=p.total-paid;

    patientsGrid.innerHTML+=`
    <div class="card" onclick="openSessions(${i})">
      <b>${p.name}</b>
      <small>Ø±Ù‚Ù… Ø§Ù„Ù…Ù„Ù: ${p.fileNo}</small><br>
      <small>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${p.total}</small><br>
      <small>Ø§Ù„Ù…Ø¯ÙÙˆØ¹: ${paid}</small><br>
      <small>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${remain}</small>
    </div>`;
  });
}

function openSessions(i){
  currentPatient=i;
  const p=patients[i];
  sessionTitle.innerText=`Ø¬Ù„Ø³Ø§Øª ${p.name}`;
  backdrop.style.display="block";
  sessionModal.style.display="block";
  renderSessions();
}

function closeSession(){
  backdrop.style.display="none";
  sessionModal.style.display="none";
}

function addSession(){
  if(!sDate.value||!sPaid.value) return;
  patients[currentPatient].sessions.push({
    date:sDate.value,
    paid:Number(sPaid.value),
    note:sNote.value
  });
  localStorage.setItem("patients",JSON.stringify(patients));
  sPaid.value="";sNote.value="";
  renderSessions();
  renderPatients();
}

function renderSessions(){
  const list=document.getElementById("sessionsList");
  list.innerHTML="";
  patients[currentPatient].sessions.forEach(s=>{
    list.innerHTML+=`<div>ğŸ“… ${s.date} â€“ ğŸ’° ${s.paid}</div>`;
  });
}

function logout(){
  localStorage.removeItem("currentUser");
  location.href="index.html";
}

renderPatients();
</script>

</body>
</html>
