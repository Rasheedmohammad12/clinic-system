<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>لوحة التحكم | Clinic System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body{font-family:Arial;background:#f4f6f8;margin:0}
    header{background:#1e88e5;color:#fff;padding:15px;text-align:center}
    .container{padding:20px}
    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px}
    .card{background:#fff;padding:20px;border-radius:8px;text-align:center;box-shadow:0 2px 6px rgba(0,0,0,.1)}
    nav{margin-top:30px;display:flex;gap:15px;flex-wrap:wrap}
    nav a{text-decoration:none;background:#1e88e5;color:#fff;padding:10px 16px;border-radius:6px}
    .user-info{font-size:14px;margin-top:10px;color:#e3f2fd}
  </style>
</head>

<body>

<header>
  <h2>نظام إدارة العيادة</h2>
  <div class="user-info" id="userInfo"></div>
</header>

<div class="container">

  <div class="cards">
    <div class="card">
      <h3>عدد المرضى</h3>
      <h1 id="patientsCount">0</h1>
    </div>
    <div class="card">
      <h3>عدد الجلسات</h3>
      <h1 id="sessionsCount">0</h1>
    </div>
    <div class="card">
      <h3>إجمالي المدفوعات</h3>
      <h1 id="paymentsTotal">0 ₪</h1>
    </div>
  </div>

  <nav>
    <a href="patients.html">المرضى</a>
    <a href="sessions.html">الجلسات</a>

    <!-- زر المدفوعات (مخفي افتراضيًا) -->
    <a href="payments.html" id="paymentsBtn" style="display:none;">المدفوعات</a>

    <a href="patient-report.html">كشف حساب</a>
    <a href="settings.html">الإعدادات</a>
    <a href="users.html">إدارة المستخدمين</a>
    <a href="#" id="logoutLink">تسجيل خروج</a>
  </nav>

</div>

<script src="assets/js/storage.js"></script>
<script src="assets/js/dashboard.js"></script>

<script type="module">
  import { requireAuth, logout, getCurrentUser } from "./assets/js/auth.js";

  requireAuth();

  const user = getCurrentUser();
  if(user){
    document.getElementById("userInfo").innerText =
      `مرحباً ${user.username} | ${user.role}`;
  }

  // إظهار زر المدفوعات إذا الرمز مُدخل
  const paymentsBtn = document.getElementById("paymentsBtn");
  if (sessionStorage.getItem("payments_access") === "true") {
    paymentsBtn.style.display = "inline-block";
  }

  // تسجيل خروج
  document.getElementById("logoutLink").onclick = e => {
    e.preventDefault();
    sessionStorage.removeItem("payments_access");
    logout();
  };
</script>

</body>
</html>
