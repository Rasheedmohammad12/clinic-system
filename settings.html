<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Settings</title>

<style>
body{
  font-family: Arial;
  margin: 0;
  background: #f1f5f9;
}
.dark{
  background:#0f172a;
  color:#fff;
}
form{
  background:#fff;
  padding:20px;
  max-width:420px;
  margin:40px auto;
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.1);
}
.dark form{background:#1e293b}

h3{
  margin-top:0;
  margin-bottom:15px;
}

label{
  display:block;
  margin-top:12px;
  font-size:14px;
}

input, select, button{
  width:100%;
  padding:10px;
  margin-top:6px;
  border-radius:10px;
  border:1px solid #cbd5e1;
  font-size:14px;
}

button{
  background:#2563eb;
  color:#fff;
  border:none;
  font-weight:bold;
  cursor:pointer;
}

.pin-box{
  margin-top:25px;
  padding-top:15px;
  border-top:1px dashed #cbd5e1;
}
</style>
</head>

<body>

<form>

  <h3>âš™ï¸ System Settings</h3>

  <!-- LANGUAGE -->
  <label>Language</label>
  <select id="lang">
    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
    <option value="en">English</option>
  </select>

  <!-- THEME -->
  <label>Theme</label>
  <select id="theme">
    <option value="light">Light</option>
    <option value="dark">Dark</option>
  </select>

  <!-- CURRENCY -->
  <label>Currency</label>
  <select id="currency">
    <option value="JOD">JOD</option>
    <option value="USD">USD</option>
    <option value="ILS">ILS</option>
  </select>

  <!-- PAYMENTS PIN -->
  <div class="pin-box">
    <h3>ğŸ” Payments PIN</h3>

    <label>Account Password</label>
    <input type="password" id="accountPassword" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø³Ø§Ø¨">

    <label>New Payments PIN</label>
    <input type="password" id="paymentsPin" placeholder="Ø±Ù…Ø² Ø³Ø±ÙŠ (4 Ø£Ø±Ù‚Ø§Ù… Ø£Ùˆ Ø£ÙƒØ«Ø±)">
  </div>

  <button type="button" id="save">Save Settings</button>

</form>

<!-- SYSTEM SETTINGS -->
<script type="module">
  import {
    getSettings,
    saveSettings,
    setPaymentsPIN
  } from "./assets/js/settings-system.js";

  import { getCurrentUser, requireAuth } from "./assets/js/auth.js";

  requireAuth();
  const user = getCurrentUser();

  const lang = document.getElementById("lang");
  const theme = document.getElementById("theme");
  const currency = document.getElementById("currency");
  const saveBtn = document.getElementById("save");

  const accountPassword = document.getElementById("accountPassword");
  const paymentsPin = document.getElementById("paymentsPin");

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
  const s = getSettings();
  lang.value = s.lang;
  theme.value = s.theme;
  currency.value = s.currency;

  saveBtn.onclick = () => {
    // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
    s.lang = lang.value;
    s.theme = theme.value;
    s.currency = currency.value;
    saveSettings(s);

    // ØªØºÙŠÙŠØ± PIN (Ø¥Ø°Ø§ Ø§Ù†ÙƒØªØ¨)
    if (paymentsPin.value) {
      if (accountPassword.value !== user.password) {
        alert("ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
        return;
      }

      if (paymentsPin.value.length < 4) {
        alert("Ø§Ù„Ø±Ù…Ø² ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 4 Ø£Ø±Ù‚Ø§Ù… Ø£Ùˆ Ø£ÙƒØ«Ø±");
        return;
      }

      setPaymentsPIN(paymentsPin.value);
      alert("ØªÙ… Ø­ÙØ¸ Ø±Ù…Ø² Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
    }

    location.reload();
  };
</script>

</body>
</html>
